---
title: 仕組みと構成解説
date: 2019-11-04 15:01:14
---

## 基本構成

teracottaを利用する上で、基本的には下記のファイル/フォルダのことを知っておく必要があります。

- マクロ本体 ( `teracotta.ttl` )
- 設定ファイル ( ` config.ini` )
- インベントリ ( ` hosts.csv` )
- シナリオ ( `.\scenario\*.ini` )
- 標準API ( `.\api.\*.ttl` )
- ユーザAPI ( `.\user-api.\*.ttl` )
- Teracottaライブラリ ( `.\lib\*.ttl` )

### マクロ本体 ( `teracotta.ttl` )

Teratermマクロとして呼び出す本体です。

このマクロファイルをユーザが編集することはありません。

また、他のttlファイルもユーザが直接実行することはありません。

### 設定ファイル ( `config.ini` )

teracotta実行後、一番最初に読み込まれます。

iniやcsvなど各セクションの設定はAPI実行前に呼び出されます。

### インベントリ ( `hosts.csv` )

Teracottaが操作する機器情報の一覧を記載するためのファイルです。

インベントリごとに、シナリオを実行する事ができます。

### シナリオ ( `.\scenario.\*.ini` )

APIを利用して、ターミナル操作の流れを記述するためのファイルです。

`[セクション名]` から始まるセクション一つに付き1つのAPI (操作1つ) を入力していきます

### 標準API ( `.\api.\*.ttl` )

Teracotta本体で提供しているAPIです。

シナリオで指定されたAPIをもとにして `.\api` フォルダ配下にある `[API].ttl` を読み込み実行します。

シナリオやインベントリ内で `type` パラメータが指定されている場合、そのサブフォルダ配下のAPIが優先して読み込まれます。

### ユーザAPI ( `.\user-api.\*.ttl` )

Teracottaで提供しきれないAPIをユーザが独自に作成し、実行することができます。

APIの読み込み順序は標準APIと同様で、標準APIよりも優先して実行されます。

### API開発用ライブラリ ( `.\lib\*.ttl` )

APIを書く際に便利なライブラリ群が格納されています。

シナリオファイルのみを利用してTeracottaを利用する場合は、これらのファイルを意識する必要はありません。

## Teracottaの基本的な実行フロー

1. Teratermの実行
2. 設定ファイルの読み込み
3. インベントリの読み込み (以下繰り返し処理)
  1. シナリオの読み込み
  2. APIの実行
  3. 処理に応じたAPI開発用ライブラリの呼び出し

